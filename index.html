<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ö–∞–º–µ—Ä–∞ –∑ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden; /* –∑–∞–±–∏—Ä–∞—î–º–æ —Å–∫—Ä–æ–ª */
    }

    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 90%;
      margin: 5px 0;
    }

    button {
      padding: 6px 10px;
      border: none;
      border-radius: 8px;
      background: #333;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #555;
    }

    #camera-container {
      position: relative;
      flex: 1;
      width: 90%;
      max-width: 500px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    video {
      width: 100%;
      border-radius: 12px;
      transform: rotate(0deg);
      transition: transform 0.3s ease;
    }

    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      pointer-events: none;
      display: flex;
      justify-content: center;
    }

    #graph {
      max-height: 30%;
    }

    #bottom-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin: 5px 0;
    }

    .arrow {
      font-size: 20px;
      background: #444;
      padding: 6px 10px;
      border-radius: 50%;
    }

    #capture-result {
      margin-top: 5px;
      max-width: 90%;
    }
  </style>
</head>
<body>
  <!-- –í–µ—Ä—Ö–Ω—è –ø–∞–Ω–µ–ª—å -->
  <div id="top-bar">
    <button id="rotate">‚ü≥</button>
    <div>
      <button id="shutter">üì∏</button>
      <button id="clear">‚ùå</button>
    </div>
  </div>

  <!-- –ö–∞–º–µ—Ä–∞ –∑ –Ω–∞–∫–ª–∞–¥–∞–Ω–Ω—è–º –≥—Ä–∞—Ñ—ñ–∫–∞ -->
  <div id="camera-container">
    <video id="camera" autoplay playsinline></video>
    <div id="overlay">
      <img id="graph" src="" alt="">
    </div>
  </div>

  <!-- –ù–∏–∂–Ω—è –ø–∞–Ω–µ–ª—å (—Å—Ç—Ä—ñ–ª–∫–∏ + –Ω–æ–º–µ—Ä –≥—Ä–∞—Ñ—ñ–∫–∞) -->
  <div id="bottom-bar">
    <button class="arrow" id="prev">‚óÄ</button>
    <span id="graph-number">0</span>
    <button class="arrow" id="next">‚ñ∂</button>
  </div>

  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–æ—Ç–æ -->
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="capture-result" alt="">

  <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const shutterBtn = document.getElementById('shutter');
    const clearBtn = document.getElementById('clear');
    const graphImg = document.getElementById('graph');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const graphNumber = document.getElementById('graph-number');
    const rotateBtn = document.getElementById('rotate');
    const resultImg = document.getElementById('capture-result');

    let currentGraph = 0;
    let totalGraphs = 5; // –∑–º—ñ–Ω—é–π –ø—ñ–¥ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–≤–æ—ó—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
    let rotation = 0;

    // –í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–∞–º–µ—Ä—É (–∑–∞–¥–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
    navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(() => {
        // —è–∫—â–æ –∑–∞–¥–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ - –≤—ñ–¥–∫—Ä–∏—î –±—É–¥—å-—è–∫—É
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => { video.srcObject = stream; });
      });

    // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
    function updateGraph() {
      graphNumber.textContent = currentGraph;
    }

    prevBtn.addEventListener('click', () => {
      currentGraph = (currentGraph - 1 + totalGraphs + 1) % (totalGraphs + 1);
      updateGraph();
    });

    nextBtn.addEventListener('click', () => {
      currentGraph = (currentGraph + 1) % (totalGraphs + 1);
      updateGraph();
    });

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –∫–ª—ñ–∫—É –Ω–∞ —Ü–∏—Ñ—Ä—É
    graphNumber.addEventListener('click', () => {
      if (currentGraph > 0) {
        graphImg.src = `graf${currentGraph}.png`;
      }
    });

    // –û—á–∏—Å—Ç–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫
    clearBtn.addEventListener('click', () => {
      graphImg.src = "";
    });

    // –ó—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ
    shutterBtn.addEventListener('click', () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight + (graphImg.src ? graphImg.height : 0);

      ctx.drawImage(video, 0, 0, canvas.width, video.videoHeight);

      if (graphImg.src) {
        ctx.drawImage(graphImg, 0, 0, canvas.width, graphImg.height);
      }

      // –¥—Ä—É–≥–µ —Ñ–æ—Ç–æ (–±–µ–∑ –≥—Ä–∞—Ñ—ñ–∫–∞) –Ω–∏–∂—á–µ
      ctx.drawImage(video, 0, video.videoHeight, canvas.width, video.videoHeight);

      resultImg.src = canvas.toDataURL("image/png");
    });

    // –ü–æ–≤–æ—Ä–æ—Ç –∫–∞–¥—Ä—É
    rotateBtn.addEventListener('click', () => {
      rotation = (rotation + 90) % 360;
      video.style.transform = `rotate(${rotation}deg)`;
    });

    updateGraph();
  </script>
</body>
</html>
